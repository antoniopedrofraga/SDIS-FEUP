package data;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;

import utilities.Constants;

public class Storage {
	static File chunks;
	Storage () {
		chunks = new File(Constants.FILES_ROOT + Constants.CHUNKS_ROOT);
		createFolders();
	}
	
	public void saveChunk(String fileId, Long chunkNo, byte[] data) throws IOException {
		File chunkFolder = new File(chunks.getPath() + "/" + fileId + "/");
		if (!chunkFolder.exists())
			chunkFolder.mkdirs();
		FileOutputStream stream = new FileOutputStream(chunkFolder.getPath() + "/" + chunkNo + ".data");
		try {
		    stream.write(data);
		} finally {
		    stream.close();
		    ChunksList chunks = chunksSaved.get(fileId) != null ? chunksSaved.get(fileId) : new ChunksList();
		    chunks.addChunk(chunkNo);
		    chunksSaved.put(fileId, chunks);
		}
		
	};
}
